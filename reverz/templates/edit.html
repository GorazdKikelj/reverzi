{% extends 'base.html' %}
{% block title %}
Reverz edit
{% endblock %}


{% block pagetitle %}
Reverz
{% endblock %}

{% block entryform %}

<div class="card text-center mb-3 bg-secondary" style="--bs-bg-opacity: .10;">
    <div class="card-body">
        <h3>{{ reverz_form.stranka.data }}</br>
            Reverz {{ reverz_form.id.data }}
            {% if not reverz_form.active.data %}
            <h3>ZAKLJUČEN</h3>
            {% endif %}
        </h3>
        <form action="{{url_for('reverz_update',id=reverz_form.id.data)}}" method="POST" id="Update"">
                {{ reverz_form.hidden_tag() }}
                <div class=" form-group">
            {{ reverz_form.customer_person_id.label(class="form-label") }}
            {% if reverz_form.active.data %}
            {{ reverz_form.customer_person_id(class="form-control") }}
            {% else %}
            {{ reverz_form.customer_person_id(class="form-control", readonly="True") }}
            {% endif %}
    </div>
    <div class="form-group">
        {{ reverz_form.person_id.label(class="form-label") }}
        {% if reverz_form.active.data %}
        {{ reverz_form.person_id(class="form-control") }}
        {% else %}
        {{ reverz_form.person_id(class="form-control", readonly="True") }}
        {% endif %}
    </div>
    <div class="form-group">
        {{ reverz_form.description.label(class="form-label") }}
        {% if reverz_form.active.data %}
        {{ reverz_form.description(class="form-control") }}
        {% else %}
        {{ reverz_form.description(class="form-control", readonly="True") }}
        {% endif %}
    </div>
    <div class="form-group">
        {{ reverz_form.demo_start_date.label(class="form-label") }}
        {% if reverz_form.active.data %}
        {{ reverz_form.demo_start_date(class="form-control") }}
        {% else %}
        {{ reverz_form.demo_start_date(class="form-control", readonly="True") }}
        {% endif %}
    </div>
    <div class="form-group">
        {{ reverz_form.demo_end_date.label(class="form-label") }}
        {% if reverz_form.active.data %}
        {{ reverz_form.demo_end_date(class="form-control") }}
        {% else %}
        {{ reverz_form.demo_end_date(class="form-control", readonly="True") }}
        {% endif %}
    </div>
    <div class="form-group">
        {{ reverz_form.demo_result.label(class="form-label") }}
        {% if reverz_form.active.data %}
        {{ reverz_form.demo_result(class="form-control", readonly="True") }}
        {% else %}
        {{ reverz_form.demo_result(class="form-control", readonly="True") }}
        {% endif %}
    </div>
    <div class="form-group">
        {{ reverz_form.demo_return_date.label(class="form-label") }}
        {% if reverz_form.active.data %}
        {{ reverz_form.demo_return_date(class="form-control") }}
        {% else %}
        {{ reverz_form.demo_return_date(class="form-control", readonly="True") }}
        {% endif %}
    </div>
    <div class="form-group">
        {{ reverz_form.active.label(class="form-label") }}
        {% if reverz_form.active.data %}
        {{ reverz_form.active(class="form-control-lg form-check-input", disabled="True") }}
        {% else %}
        {{ reverz_form.active(class="form-control-lg form-check-input", disabled="True") }}
        {% endif %}
    </div>
</div>
<div class="card-footer">
    {{ reverz_form.modified_by.label(class="form-label") }}
    {{ reverz_form.modified_by(class="form-control", readonly="True") }}
    {% if reverz_form.active.data %}
    <button class="btn">
        <a class="btn btn-primary" href="{{url_for('reverz_close',id=reverz_form.id.data)}}">Zaključi reverz</a>
    </button>&nbsp;&nbsp;
    {{ reverz_form.submit(class="btn btn-primary") }}
    {% endif %}
    <button class="btn">
        <a class="btn btn-success" href="{{url_for('reverz_print_page',id=reverz_form.id.data)}}" title="Print"
            target="Printer">
            Print
        </a>
    </button>
    {% if reverz_form.active.data %}
    <button class="btn">
        <a class="btn btn-warning" href="{{url_for('reverz_page')}}">Prekliči</a>
    </button>
    {% else %}
    <button class="btn">
        <a class="btn btn-warning" href="{{url_for('reverz_page')}}">Nazaj</a>
    </button>
    {% endif %}

</div>

</div>

{% endblock %}

{% block tableheader %}
<th data-valign="top"">#</th>
<th data-valign=" top" data-field="koda" data-filter-control="input" data-sortable="True">Produktna št. (Part No)</th>
<th data-valign="top" data-field="serijska" data-filter-control="input" data-sortable="True">Serijska št. (Serial No)
</th>
<th data-valign="top" data-field="opis" data-filter-control="input" data-sortable="True">Opis</th>
<th data-valign="top">
    {% if reverz_form.active.data %}
    <button class="btn btn-lg">

        <a class="btn" href="{{url_for('reverz_add_item',id=reverz_form.id.data)}}">
            <i class="bi bi-plus-lg"></i>
        </a>

    </button>
    Akcije
    {% endif %}
</th>
{% endblock %}

{% block tablerows %}
{% for row in inventory %}
<tr>
    <td>{{ row.trans_id }}</td>
    <td><span title="Notes: {{row.notes}}">{{ row.koda }}</span></td>
    <td><span title="Notes: {{row.notes}}">{{ row.serijska }}</span></td>
    <td><span title="Notes: {{row.notes}}">{{ row.opis }}
            {% if row.part_notes==None or row.part_notes=='' %}
            {% else %}
            <hr>{{ row.part_notes }}
            {% endif %}
        </span></td>
    <td>
        <div class="d-grid gap-1 d-md-flex justify-content-md-end">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-sm " data-bs-toggle="modal"
                data-bs-target="#reverzModal{{row.trans_id}}">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                    class="bi bi-info-square" viewBox="0 0 16 16">
                    <path
                        d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                    <path
                        d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
                </svg>
            </button>

            <!-- Modal -->
            <div class="modal fade" id="reverzModal{{row.trans_id}}" tabindex="-1" aria-labelledby="{{row.trans_id}}"
                aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="reverzModalLabel{{row.trans_id}}">Podrobnosti
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <table class="table-responsive table-sm table-hover bg-white">
                                <tr>
                                    <td>Status:</td>
                                    <td>
                                        <h5>{% if row.konec|string < datum_now and row.aktivna %} POTEKEL {% elif
                                                row.aktivna %} IZDAN {% else %} ZAKLJUČEN {% endif %}</h5>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Transakcija:</td>
                                    <td>{{ row.trans_id }}</td>
                                </tr>
                                <tr>
                                    <td>Inventarna št:</td>
                                    <td>{{ row.inventarna_st }}</td>
                                </tr>
                                <tr>
                                    <td>Part No:</td>
                                    <td>{{ row.koda }}</td>
                                </tr>
                                <tr>
                                    <td>Opis:</td>
                                    <td>{{ row.opis }}</td>
                                </tr>
                                <tr>
                                    <td>Namen testiranja:</td>
                                    <td>
                                        <pre>{{ row.namen or "" }}</pre>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Opombe:</td>
                                    <td>
                                        <pre>{{ row.notes or "" }}</pre>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Datum izdaje:</td>
                                    <td>{{ row.začetek or "" }}</td>
                                </tr>
                                <tr>
                                    <td>Izdan do:</td>
                                    <td>{{ row.konec or "" }}</td>
                                </tr>
                                <tr>
                                    <td>Datum vračila:</td>
                                    <td>{{ row.vrnitev or "" }}</td>
                                </tr>
                                <tr>
                                    <td>Zadnja sprememba:</td>
                                    <td>{{ row.last_update }} {{ row.last_user or "" }}</td>
                                </tr>

                            </table>
                        </div>
                    </div>
                </div>
            </div>


            {% if reverz_form.active.data %}


            <button class="btn ">
                <a class="btn  btn-outline-primary"
                    href="{{url_for('reverz_edit_item',rev_id=reverz_form.id.data, id=row.trans_id)}}">Edit</a></button>
            <button class="btn ">
                <a class="btn btn-outline-danger"
                    href="{{url_for('reverz_remove', rev_id=reverz_form.id.data, id=row.trans_id)}}">Remove</a></button>
            {% endif %}
        </div>
    </td>
</tr>
{% endfor %}
{% endblock %}